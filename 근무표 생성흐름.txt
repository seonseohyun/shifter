# ê·¼ë¬´í‘œ ìƒì„± ë° ìˆ˜ì • íë¦„ë„

## ðŸ”„ ê·¼ë¬´í‘œ ìƒì„± íë¦„

### 1. **ìƒˆ ê·¼ë¬´í‘œ ìƒì„±** (ì›”ê°„ ìŠ¤ì¼€ì¤„ ìƒì„±)

```
ê´€ë¦¬ìž/ì‹œìŠ¤í…œì´ ì›” ê·¼ë¬´í‘œ ìƒì„± ìš”ì²­
    â†“
ì§ì› ì •ë³´ ì†ŒìŠ¤ ì„ íƒ
    â”œâ”€ ì˜µì…˜ A: í´ë¼ì´ì–¸íŠ¸ì—ì„œ JSON ì „ì†¡
    â””â”€ ì˜µì…˜ B: DBì—ì„œ team_idë¡œ ì¡°íšŒ
    â†“
Python ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰
    â†“
ì œì•½ì¡°ê±´ ì ìš© (team_constraint í…Œì´ë¸” ì°¸ì¡°)
    â†“
OR-Toolsë¡œ ìµœì  ìŠ¤ì¼€ì¤„ ìƒì„±
    â†“
ìŠ¤ì¼€ì¤„ ìƒì„± ì„±ê³µ?
    â”œâ”€ ì„±ê³µ â†’ íŠ¸ëžœìž­ì…˜ ì‹œìž‘
    â””â”€ ì‹¤íŒ¨ â†’ ì˜¤ë¥˜ ì‘ë‹µ ë°˜í™˜
    â†“
ê¸°ì¡´ íŒ€ ìŠ¤ì¼€ì¤„ ì‚­ì œ
DELETE FROM duty_schedule WHERE team_id=? AND schedule_month=?
    â†“
ìƒˆ ìŠ¤ì¼€ì¤„ ë°°ì¹˜ ì‚½ìž…
INSERT INTO duty_schedule...
    â†“
íŠ¸ëžœìž­ì…˜ ì»¤ë°‹
    â†“
ì„±ê³µ ì‘ë‹µ
```

#### êµ¬ì²´ì  SQL íë¦„:

```sql
-- 1ë‹¨ê³„: íŒ€ ì§ì› ì •ë³´ ì¡°íšŒ (ì˜µì…˜ Bì¸ ê²½ìš°)
SELECT staff_id, name, grade, grade_name 
FROM staff 
WHERE team_id = ? AND is_active = TRUE;

-- 2ë‹¨ê³„: íŒ€ ì œì•½ì¡°ê±´ ì¡°íšŒ
SELECT constraint_type, params, weight_point
FROM team_constraint 
WHERE team_id = ? AND is_active = TRUE;

-- 3ë‹¨ê³„: ê¸°ì¡´ ìŠ¤ì¼€ì¤„ ì‚­ì œ (íŠ¸ëžœìž­ì…˜ ë‚´)
DELETE FROM duty_schedule 
WHERE team_id = ? AND schedule_month = ?;

-- 4ë‹¨ê³„: ìƒˆ ìŠ¤ì¼€ì¤„ ë°°ì¹˜ ì‚½ìž…
INSERT INTO duty_schedule 
(staff_id, team_id, schedule_month, duty_date, shift_code, work_hours) 
VALUES 
('101', 1, '2025-08', '2025-08-01', 'D', 8),
('102', 1, '2025-08', '2025-08-01', 'E', 8),
-- ... (31ì¼ Ã— íŒ€ì›ìˆ˜ ë§Œí¼)
```

---

### 2. **ê·¼ë¬´í‘œ ìˆ˜ì •** (ê°œë³„ ê·¼ë¬´ ë³€ê²½)

```
ì§ì›ì´ ê·¼ë¬´ ë³€ê²½ ìš”ì²­
    â†“
change_requests í…Œì´ë¸”ì— INSERT
    â†“
ê´€ë¦¬ìž ìŠ¹ì¸ ëŒ€ê¸°
    â†“
ìŠ¹ì¸ ì—¬ë¶€
    â”œâ”€ ìŠ¹ì¸ â†’ Python ìŠ¤ì¼€ì¤„ëŸ¬ ìž¬ì‹¤í–‰ (ë³€ê²½ ìš”ì²­ í¬í•¨)
    â””â”€ ê±°ë¶€ â†’ statusë¥¼ REJECTEDë¡œ ì—…ë°ì´íŠ¸
    â†“
ìƒˆ ìŠ¤ì¼€ì¤„ ìƒì„± ê°€ëŠ¥?
    â”œâ”€ ê°€ëŠ¥ â†’ íŠ¸ëžœìž­ì…˜ ì‹œìž‘
    â””â”€ ë¶ˆê°€ëŠ¥ â†’ ë³€ê²½ ë¶ˆê°€ ì‘ë‹µ
    â†“
ë³€ê²½ëœ ë¶€ë¶„ë§Œ ì—…ë°ì´íŠ¸
UPDATE duty_schedule
    â†“
ì´ë ¥ í…Œì´ë¸”ì— ê¸°ë¡
INSERT INTO schedule_history
    â†“
ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
UPDATE change_requests SET status='APPLIED'
    â†“
íŠ¸ëžœìž­ì…˜ ì»¤ë°‹
```

#### êµ¬ì²´ì  SQL íë¦„:

```sql
-- 1ë‹¨ê³„: ë³€ê²½ ìš”ì²­ ë“±ë¡
INSERT INTO change_requests 
(staff_id, team_id, duty_date, original_shift, desired_shift, request_reason)
VALUES ('101', 1, '2025-08-15', 'D', 'O', 'ê°œì¸ ì‚¬ì •');

-- 2ë‹¨ê³„: ìŠ¹ì¸ í›„ ìŠ¤ì¼€ì¤„ ë³€ê²½ (íŠ¸ëžœìž­ì…˜ ë‚´)
-- 2-1: ê¸°ì¡´ ê·¼ë¬´ ë‚´ìš© ì¡°íšŒ
SELECT shift_code FROM duty_schedule 
WHERE staff_id = '101' AND duty_date = '2025-08-15';

-- 2-2: ê·¼ë¬´ ë³€ê²½
UPDATE duty_schedule 
SET shift_code = 'O', 
    work_hours = 0,
    is_changed = TRUE,
    change_reason = 'ê°œì¸ ì‚¬ì •',
    updated_at = NOW()
WHERE staff_id = '101' AND duty_date = '2025-08-15';

-- 2-3: ë³€ê²½ ì´ë ¥ ê¸°ë¡
INSERT INTO schedule_history 
(staff_id, team_id, duty_date, old_shift_code, new_shift_code, 
 change_type, change_reason, requested_by, approved_by)
VALUES ('101', 1, '2025-08-15', 'D', 'O', 'REQUEST', 'ê°œì¸ ì‚¬ì •', '101', 'MANAGER01');

-- 2-4: ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
UPDATE change_requests 
SET status = 'APPLIED', 
    processed_by = 'MANAGER01',
    processed_at = NOW()
WHERE id = ?;
```

---

## ðŸŽ¯ í•µì‹¬ ì°¨ì´ì : í˜„ìž¬ vs ê°œì„ 

### í˜„ìž¬ ë°©ì‹
```cpp
// ë§¤ë²ˆ ì „ì²´ ì›” ë°ì´í„° ì‚­ì œ
DELETE FROM duty_schedule WHERE duty_date >= '2025-08-01' AND duty_date <= '2025-08-31';
// ëª¨ë“  íŒ€ ë°ì´í„° ì˜í–¥ë°›ìŒ âŒ
```

### ê°œì„ ëœ ë°©ì‹
```cpp
// íŒ€ë³„ ì„ íƒì  ì‚­ì œ
DELETE FROM duty_schedule WHERE team_id = ? AND schedule_month = ?;
// í•´ë‹¹ íŒ€ë§Œ ì˜í–¥ë°›ìŒ âœ…
```

---

## ðŸš€ ì„±ëŠ¥ ìµœì í™” í¬ì¸íŠ¸

### 1. **UPSERT ë°©ì‹** (ë” ë‚˜ì€ ê°œì„ ì•ˆ)
```sql
-- ì‚­ì œ/ì‚½ìž… ëŒ€ì‹  UPSERT ì‚¬ìš©
INSERT INTO duty_schedule (staff_id, team_id, schedule_month, duty_date, shift_code, work_hours)
VALUES (?, ?, ?, ?, ?, ?)
ON DUPLICATE KEY UPDATE
  shift_code = VALUES(shift_code),
  work_hours = VALUES(work_hours),
  updated_at = NOW();
```

### 2. **ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”**
```sql
-- í•œ ë²ˆì— ì—¬ëŸ¬ í–‰ ì‚½ìž…
INSERT INTO duty_schedule VALUES 
(?, ?, ?, ?, ?, ?),
(?, ?, ?, ?, ?, ?),
-- ... ìµœëŒ€ 1000ê°œì”© ë°°ì¹˜
```

### 3. **íŒŒí‹°ì…”ë‹ íš¨ê³¼**
- ì›”ë³„ íŒŒí‹°ì…˜ìœ¼ë¡œ ê²€ìƒ‰ ë²”ìœ„ ìžë™ ì œí•œ
- ë‹¤ë¥¸ ì›” ë°ì´í„°ì— ì˜í–¥ ì—†ìŒ

---

## ðŸ”„ ì‹¤ì œ êµ¬í˜„ ì˜ˆì‹œ (C++ ìˆ˜ì •)

```cpp
// ê°œì„ ëœ generate_and_update_schedule_by_team í•¨ìˆ˜
void generate_and_update_schedule_by_team(MYSQL* conn, int team_id, const std::string& year_month) {
    // Python ì‹¤í–‰ ì‹œ íŒ€ ì •ë³´ ì „ë‹¬
    std::string command = "python shift_scheduler.py --team_id=" + std::to_string(team_id) 
                         + " --year_month=" + year_month;
    
    // íŠ¸ëžœìž­ì…˜ ì‹œìž‘
    mysql_query(conn, "START TRANSACTION");
    
    try {
        // 1. í•´ë‹¹ íŒ€ì˜ í•´ë‹¹ ì›” ë°ì´í„°ë§Œ ì‚­ì œ
        const char* delete_query = "DELETE FROM duty_schedule WHERE team_id = ? AND schedule_month = ?";
        // ... delete ì‹¤í–‰
        
        // 2. JSON íŒŒì¼ì—ì„œ ìƒˆ ë°ì´í„° ì½ì–´ì„œ ë°°ì¹˜ ì‚½ìž…
        // ... insert ì‹¤í–‰
        
        mysql_query(conn, "COMMIT");
        std::cout << "[SUCCESS] íŒ€ " << team_id << "ì˜ " << year_month << " ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸ ì™„ë£Œ" << std::endl;
        
    } catch (const std::exception& e) {
        mysql_query(conn, "ROLLBACK");
        std::cerr << "[ERROR] ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " << e.what() << std::endl;
    }
}
```

## ðŸ“Š ì„±ëŠ¥ í–¥ìƒ ì˜ˆìƒ íš¨ê³¼

### í˜„ìž¬ â†’ ê°œì„  ë¹„êµ
- **ë‹¨ì¼ íŒ€ (20ëª…) ìŠ¤ì¼€ì¤„ ìƒì„±**: 20ë°° ë¹ ë¦„
- **5íŒ€ ë³‘ì› í™˜ê²½**: íŒ€ë³„ ë…ë¦½ ì²˜ë¦¬ë¡œ ë½ ê²½í•© ì—†ìŒ  
- **ë™ì‹œ ì—…ë°ì´íŠ¸**: ë½ ê²½í•© 90% ê°ì†Œ
- **ë¡¤ë°± ì˜í–¥ë„**: íŒ€ë³„ ê²©ë¦¬ë¡œ ì•ˆì „ì„± ëŒ€í­ í–¥ìƒ

### íŠ¸ëžœìž­ì…˜ ë²”ìœ„ ìµœì í™”
- **í˜„ìž¬**: ì „ì²´ ë³‘ì› ë°ì´í„° ë½
- **ê°œì„ **: íŒ€ë³„ ë°ì´í„°ë§Œ ë½
- **ê²°ê³¼**: ë‹¤ë¥¸ íŒ€ ì—…ë¬´ì— ì˜í–¥ ì—†ìŒ

ì´ë ‡ê²Œ í•˜ë©´ **íŒ€ Aì˜ ìŠ¤ì¼€ì¤„ì„ ë³€ê²½í•´ë„ íŒ€ B, CëŠ” ì „í˜€ ì˜í–¥ë°›ì§€ ì•Šê³ **, **ì„±ëŠ¥ë„ 20-50ë°° í–¥ìƒ**ë©ë‹ˆë‹¤! ðŸš€