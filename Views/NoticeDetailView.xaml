<Page x:Class="ShifterUser.Views.NoticeDetailView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      FontFamily="Noto Sans KR"
      Width="400" Height="800"
      Background="White">

    <Page.Resources>
        <DropShadowEffect x:Key="ShadowEffect"
                          Color="Black"
                          ShadowDepth="5"
                          BlurRadius="10"
                          Opacity="0.5"/>
    </Page.Resources>

    <Grid>
        <!-- 상단바 -->
        <Border Background="#007AFF" Height="56" VerticalAlignment="Top">
            <Grid>
                <Button Content="＜"
                        Command="{Binding GoBackCommand}"
                        Width="40" Height="40"
                        Background="Transparent"
                        BorderBrush="Transparent"
                        FontSize="16"
                        FontWeight="Bold"
                        Foreground="White"
                        HorizontalAlignment="Left"
                        Style="{StaticResource RoundedBlueButtonStyle}"
                        VerticalAlignment="Center" Margin="4,0,0,0"/>
                <TextBlock Text="공지사항"
                           Foreground="White"
                           FontSize="16"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- 본문 -->
        <Grid Margin="16,72,16,26">
            <!-- 카드 그림자 + 테두리 -->
            <Border Background="White" CornerRadius="20" Effect="{StaticResource ShadowEffect}"/>
            <Border Background="White" CornerRadius="20" BorderBrush="#DDDDDD" BorderThickness="1">
                <!-- 카드 내부: 아래(첨부) 고정, 위(본문) 스크롤 -->
                <DockPanel LastChildFill="True" Margin="16">

                    <!-- ===== 하단: 첨부 자료 (고정) ===== -->
                    <StackPanel DockPanel.Dock="Bottom" Margin="0,12,0,60">
                        <Border Height="1.5" Background="#E6E6E6" Margin="0,0,0,12"/>
                        <TextBlock Text="첨부 자료" FontWeight="Bold" FontSize="18" Margin="0,0,0,8"/>

                        <!-- Attachments: ObservableCollection<AttachmentItem> -->
                        <ItemsControl ItemsSource="{Binding Attachments}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,4,0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- 아이콘 -->
                                        <Image Grid.Column="0"
                                               Source="{Binding IconSource}"
                                               Width="16" Height="16"
                                               Margin="0,0,10,0"/>

                                        <!-- 파일 이름 -->
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding FileName}"
                                                   VerticalAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"/>

                                        <!-- 다운로드 버튼 -->
                                        <Button Grid.Column="2"
                                                Content="↓"
                                                Width="24" Height="24"
                                                Margin="10,0,0,0"
                                                Command="{Binding DataContext.DownloadAttachmentCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                CommandParameter="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- ===== 위: 본문(남은 영역만 스크롤) ===== -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- 제목 -->
                            <TextBlock Text="{Binding Notice.Title}"
                                       FontSize="21"
                                       FontWeight="Bold"
                                       TextWrapping="Wrap"
                                       Margin="4,8,4,6"/>

                            <!-- 작성자 / 날짜 -->
                            <Grid Margin="4,0,4,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="{Binding Notice.StaffName}"
                                           Foreground="Gray"/>
                                <TextBlock Grid.Column="1"
                                           Text="{Binding Notice.NoticeDate}"
                                           Foreground="Gray"
                                           HorizontalAlignment="Right"/>
                            </Grid>

                            <Border Height="1.5" Background="#E6E6E6" Margin="0,0,0,12"/>

                            <!-- 내용 -->
                            <TextBlock Text="{Binding Notice.Content}"
                                       TextWrapping="Wrap"
                                       FontSize="15"
                                       LineHeight="22"
                                       Margin="4,0,4,0"/>
                        </StackPanel>
                    </ScrollViewer>

                </DockPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
