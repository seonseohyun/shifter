<Page x:Class="ShifterUser.Views.GroupDashboardView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:conv="clr-namespace:ShifterUser.Converters"
      FontFamily="Noto Sans KR"
      Width="400" Height="800"
      Background="White"
      Loaded="Page_Loaded">

    <Page.Resources>
        <!-- 그림자 -->
        <DropShadowEffect x:Key="ShadowEffect"
                          Color="Black"
                          ShadowDepth="5"
                          BlurRadius="10"
                          Opacity="0.5"/>

        <!-- === 하루고리 근무표 팔레트(진한: 헤더, 연한: 칩) === -->
        <SolidColorBrush x:Key="ShiftDayBrush"    Color="#FFB300"/>
        <SolidColorBrush x:Key="ShiftEveBrush"    Color="#26A69A"/>
        <SolidColorBrush x:Key="ShiftNightBrush"  Color="#283593"/>
        <SolidColorBrush x:Key="ShiftOffBrush"    Color="#757575"/>

        <SolidColorBrush x:Key="ShiftDayChipBrush"   Color="#FFF3CD"/>
        <SolidColorBrush x:Key="ShiftEveChipBrush"   Color="#E0F2F1"/>
        <SolidColorBrush x:Key="ShiftNightChipBrush" Color="#E8EAF6"/>
        <SolidColorBrush x:Key="ShiftOffChipBrush"   Color="#F5F5F5"/>

        <!-- 컨버터 인스턴스 등록 -->
        <conv:ShiftToCodeConverter x:Key="ShiftToCodeConverter"/>
        <!-- 헤더(진한색)용 -->
        <conv:ShiftToBrushConverter x:Key="ShiftToHeaderBrush"
                                    DayBrush="{StaticResource ShiftDayBrush}"
                                    EveBrush="{StaticResource ShiftEveBrush}"
                                    NightBrush="{StaticResource ShiftNightBrush}"
                                    OffBrush="{StaticResource ShiftOffBrush}"/>
        <!-- 칩(연한색)용 -->
        <conv:ShiftToBrushConverter x:Key="ShiftToChipBrush"
                                    DayBrush="{StaticResource ShiftDayChipBrush}"
                                    EveBrush="{StaticResource ShiftEveChipBrush}"
                                    NightBrush="{StaticResource ShiftNightChipBrush}"
                                    OffBrush="{StaticResource ShiftOffChipBrush}"/>

        <!-- 배지/칩 공통 스타일 -->
        <Style x:Key="ShiftBadgeBorder" TargetType="Border">
            <Setter Property="Padding" Value="8,3"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Background" Value="#E0E0E0"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <Style x:Key="StaffChipBorder" TargetType="Border">
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="#F5F5F5"/>
            <Setter Property="Margin" Value="0,6,6,0"/>
        </Style>
    </Page.Resources>

    <Grid>

        <!-- 상단바 -->
        <Border Background="#007AFF" Height="56" VerticalAlignment="Top">
            <Grid>
                <Button Content="＜"
                        Command="{Binding GoBackCommand}"
                        Width="40" Height="40"
                        Background="Transparent"
                        BorderBrush="Transparent"
                        FontSize="16"
                        FontWeight="Bold"
                        Foreground="White"
                        HorizontalAlignment="Left"
                        Style="{StaticResource RoundedBlueButtonStyle}"
                        VerticalAlignment="Center" Margin="4,0,0,0"/>
            </Grid>
        </Border>

        <!-- 콘텐츠 카드 -->
        <Grid VerticalAlignment="Top" HorizontalAlignment="Left" Margin="27,215,0,0">
            <!-- 그림자 -->
            <Border Width="350" CornerRadius="20" Margin="0,-121,0,0"
                    Background="White" Effect="{StaticResource ShadowEffect}"/>

            <!-- 실제 콘텐츠 -->
            <Border Width="350"  Padding="16"
                    BorderThickness="1"
                    CornerRadius="20" Margin="0,-121,0,0"
                    Background="White"
                    BorderBrush="#DDDDDD" Height="657" VerticalAlignment="Top">

                <StackPanel>

                    <!-- 상단 텍스트 -->
                    <TextBlock Text="{Binding TopTeamName}" FontSize="21" FontWeight="Bold"
                               Margin="0,5,0,20" TextAlignment="Center"/>

                    <!-- 팀 선택 -->
                    <ComboBox ItemsSource="{Binding Teams}"
                              SelectedItem="{Binding SelectedTeam, Mode=TwoWay}"
                              Height="36" FontSize="14" Margin="0,0,0,15"
                              Padding="8,0"
                              VerticalContentAlignment="Center" Width="310"/>

                    <!-- 액션 버튼들 -->
                    <UniformGrid Columns="2" Margin="0,0,0,15">
                        <Button Height="100" Width="150" Command="{Binding GoToNoticeCommand}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border BorderThickness="1" BorderBrush="#007AFF" Background="#007AFF" CornerRadius="12">
                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <Image Source="/Resources/images/WhiteBell.png" Width="35" Height="35" Margin="0,5,0,4"/>
                                            <TextBlock Text="공지사항 보기" FontWeight="Bold" Foreground="White" FontSize="15" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <Button Margin="4" Height="100" Width="150" Command="{Binding GoToHandoverCommand}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border BorderThickness="2" BorderBrush="#007AFF" Background="White" CornerRadius="12">
                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <Image Source="/Resources/images/Doc.png" Width="31" Height="31" Margin="0,0,0,10"/>
                                            <TextBlock Text="인수인계 보기" FontWeight="Bold" Foreground="#007AFF" FontSize="15" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="22"/>
                                </Style>
                            </Button.Resources>
                        </Button>
                    </UniformGrid>

                    <!-- 오늘 팀 출근 현황 -->
                    <ScrollViewer Margin="0,0,0,0" VerticalScrollBarVisibility="Hidden">
                        <StackPanel>

                            <!-- 타이틀 -->
                            <TextBlock Text="오늘 팀 출근 현황"
                                       FontSize="18" FontWeight="Bold"
                                       Margin="0,10,0,20"/>

                            <!-- 교대별 섹션 리스트 -->
                            <ItemsControl ItemsSource="{Binding TodayGroups}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,0,0,14">

                                         
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                                                <!-- 교대 배지: 배경은 Shift→Brush(진한), 텍스트는 Shift→코드 -->
                                                <Border Style="{StaticResource ShiftBadgeBorder}"
                                                        Background="{Binding Shift, Converter={StaticResource ShiftToHeaderBrush}}">
                                                    <TextBlock Text="{Binding Shift, Converter={StaticResource ShiftToCodeConverter}}"
                                                               Foreground="White" FontWeight="Bold" FontSize="14"/>
                                                </Border>

                                                <TextBlock Text="{Binding Staff.Count, StringFormat={}{0}명}"
                                                           Margin="8,0,0,0"
                                                           VerticalAlignment="Center" Foreground="#666" FontSize="13"/>
                                            </StackPanel>

                                            <!-- 이름 칩: 배경은 (부모)Shift→Brush(연한) -->
                                            <ItemsControl ItemsSource="{Binding Staff}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource StaffChipBorder}"
                                                                Background="{Binding DataContext.Shift, RelativeSource={RelativeSource AncestorType=ItemsControl}, Converter={StaticResource ShiftToChipBrush}}">
                                                            <TextBlock Text="{Binding}" FontSize="13" Foreground="#333"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- 빈 상태 (App.xaml의 ZeroToVisibleConverter 사용) -->
                            <TextBlock Text="오늘 근무 예정인 팀원이 없어요."
                                       Foreground="#888" HorizontalAlignment="Center" Margin="0,8,0,0"
                                       Visibility="{Binding TodayGroups.Count, Converter={StaticResource ZeroToVisibleConverter}}"/>

                        </StackPanel>
                    </ScrollViewer>

                </StackPanel>
            </Border>
        </Grid>

        <!-- 하단 로고-->
    </Grid>
</Page>
