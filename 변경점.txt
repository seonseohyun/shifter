shifter 프로젝트 변경점 기록
=====================================
날짜: 2025년 8월 1일 (2차 수정)

주요 변경사항: main.cpp 파일에 자연어 근무교대 요청 처리 기능 통합
===================================================================

1. 헤더 파일 추가
------------------
- #include <regex> 추가: 정규표현식 처리를 위함
- #include <cstdlib> 추가: system() 함수 사용을 위함
- #include <cstdio> 추가: sscanf() 함수 사용을 위함

2. 새로운 구조체 추가
--------------------
- ParsedData 구조체 추가:
  * name: 직원 이름
  * date: 근무 날짜
  * fromShift: 기존 근무 시간대
  * toShift: 변경할 근무 시간대

3. 새로운 함수 추가
------------------
가. parseNaturalLanguage() 함수
- 자연어 입력을 파싱하여 구조화된 데이터로 변환
- 정규표현식을 사용하여 "이름 날짜 X근무에서 Y근무로 변경을 희망합니다." 형태의 입력 처리

나. updateAndExecuteShiftScheduler() 함수
- 초기 버전: 자연어 입력을 받아서 처리
- 최종 버전: 4개의 개별 매개변수를 받아서 처리 (staff_id, date_, shift_from, shift_to)
- 주요 기능:
  * Python 파일(shift_scheduler.py) 읽기
  * 날짜 유효성 검사 (2025년 8월 범위)
  * Python 코드에 제약조건 삽입
  * 백업 파일 생성 후 수정된 내용 저장
  * Python 스크립트 실행
  * 결과에 따른 적절한 메시지 반환

4. 새로운 프로토콜 추가
----------------------
가. GetSchedule 프로토콜
- 기능: time_table.json 파일의 내용을 클라이언트에 전송
- 응답: schedule_data 프로토콜로 JSON 내용 반환
- 에러 처리: 파일을 찾을 수 없는 경우 적절한 에러 메시지

나. ChangeShift 프로토콜
- 기능: 근무교대 요청 처리
- 입력 필드:
  * staff_id: 직원 ID
  * date_: 근무 날짜 (YYYY-MM-DD 형식)
  * shift_from: 기존 근무 시간대
  * shift_to: 변경할 근무 시간대
- 응답 타입:
  * change_success: 변경 성공
  * no_solution: 해가 없음
  * change_error: 처리 중 오류 발생
- 성공 시 generate_and_insert_schedule() 함수 호출하여 DB 업데이트

5. 오류 처리 강화
----------------
- 파일 읽기/쓰기 오류 처리
- 날짜 유효성 검사
- Python 스크립트 실행 오류 처리
- 필수 JSON 필드 누락 검사
- "해가 없습니다" 메시지 특별 처리

6. 주요 워크플로우
-----------------
1) C# 클라이언트 → ChangeShift 프로토콜로 요청
2) 서버에서 4개 필드 추출 (staff_id, date_, shift_from, shift_to)
3) shift_scheduler.py 파일을 읽어서 제약조건 추가
4) 수정된 Python 파일 실행
5) 실행 결과에 따라 적절한 응답 반환
6) 성공 시 새로운 스케줄을 데이터베이스에 저장

7. 기존 기능 유지
----------------
- Hello 프로토콜: 연결 확인
- Insert 프로토콜: 테스트 데이터 삽입
- 기존 데이터베이스 연결 및 스케줄 저장 기능

8. 개선사항
-----------
- 자연어 처리에서 구조화된 JSON 데이터 처리로 변경
- 더 정확하고 안정적인 데이터 처리
- 명확한 에러 메시지 제공
- 백업 파일 생성으로 안전성 향상

===================================================================
2차 수정 사항 (CLAUDE.md 기반 최종 개선)
===================================================================

9. 자연어 처리 함수 제거
----------------------
- parseNaturalLanguage() 함수 완전 제거
- ParsedData 구조체 제거
- updateAndExecuteShiftSchedulerFromNaturalLanguage() 함수 제거
- 자연어 처리 관련 모든 코드 정리

10. JSON 파일 기반 처리 방식 변경
-------------------------------
- CLAUDE.md의 개선된 방식 적용
- change_requests.json 파일을 통한 요청 처리
- 원자적 파일 쓰기 (.tmp 파일 사용)
- Python 스크립트에서 JSON 파일 읽어서 동적 제약조건 적용

11. DB 업데이트 로직 개선
-----------------------
- generate_and_insert_schedule() → generate_and_update_schedule()로 함수명 변경
- 트랜잭션 기반 안전한 업데이트 구현:
  * START TRANSACTION으로 트랜잭션 시작
  * 기존 2025년 8월 데이터 DELETE
  * 새로운 스케줄 데이터 INSERT
  * COMMIT으로 트랜잭션 완료
  * 오류 시 ROLLBACK으로 데이터 일관성 보장

12. UTF-8 인코딩 최적화
---------------------
- client.cpp: u8 리터럴 사용으로 UTF-8 보장
- main.cpp: UTF-8 로케일 설정 추가
- 한글 깨짐 현상 완전 해결

13. 코드 구조 최적화
------------------
- 불필요한 자연어 처리 코드 제거
- JSON 기반 구조화된 데이터 처리로 일원화
- 에러 처리 및 트랜잭션 안전성 강화

최종 워크플로우:
1) C# 클라이언트 → ChangeShift 프로토콜로 JSON 요청 (staff_id, date_, shift_from, shift_to)
2) 서버에서 change_requests.json 파일에 요청 저장 (원자적 쓰기)
3) Python 스크립트 실행 (JSON 파일에서 제약조건 동적 로드)
4) 실행 결과에 따라 적절한 응답 반환
5) 성공 시 기존 DB 데이터 삭제 후 새로운 스케줄로 업데이트 (트랜잭션 보장)

이번 변경으로 더욱 안정적이고 확장 가능한 근무표 변경 시스템이 완성되었습니다.