# ê·¼ë¬´í‘œ ìƒì„± ì‹œìŠ¤í…œ ë³€ê²½ì  ë° ê°œì„ ì‚¬í•­

## ğŸ“… ë³€ê²½ ì¼ì: 2025-08-04

## ğŸ”„ ì£¼ìš” ë³€ê²½ì‚¬í•­

### 1. ì›” ì´ ê·¼ë¬´ì‹œê°„ ì œì•½ì¡°ê±´ ì¶”ê°€
- **ë³€ê²½ ë‚´ìš©**: `total_monthly_work_hours` í•„ë“œ ì§€ì› ì¶”ê°€
- **êµ¬í˜„ ìœ„ì¹˜**: `server_shift_scheduler.py` ë¼ì¸ 95-103
- **ì„¸ë¶€ì‚¬í•­**:
  - ê° ì§ì›ë³„ ì›” ìµœëŒ€ ê·¼ë¬´ì‹œê°„ ì„¤ì • ê°€ëŠ¥
  - 10% ì—¬ìœ ë¶„ ìë™ ì ìš©ìœ¼ë¡œ í•´ ì°¾ê¸° ê°€ëŠ¥ì„± ì¦ëŒ€
  - ê¸°ë³¸ê°’: 180ì‹œê°„ (ë¯¸ì„¤ì •ì‹œ)
  - ì˜ˆì‹œ: 180ì‹œê°„ â†’ 198ì‹œê°„(ì—¬ìœ ë¶„ í¬í•¨)ìœ¼ë¡œ ì œì•½ ì ìš©

### 2. ì œì•½ì¡°ê±´ ì™„í™”ë¥¼ í†µí•œ ì„±ëŠ¥ ìµœì í™”
- **ì£¼ë‹¹ ê·¼ë¬´ì‹œê°„ ì œí•œ**: 40ì‹œê°„ â†’ 50ì‹œê°„ (ë¼ì¸ 105-112)
- **ìµœì†Œ íœ´ë¬´ì¼**: ì›” 3ì¼ â†’ 2ì¼ (ë¼ì¸ 90-93)
- **ì•¼ê°„ ê·¼ë¬´ í›„ íœ´ë¬´**: ì†Œí”„íŠ¸ ì œì•½ â†’ í•˜ë“œ ì œì•½ìœ¼ë¡œ ë‹¨ìˆœí™”
  - ë³µì¡í•œ ìœ„ë°˜ ë³€ìˆ˜ ì œê±°ë¡œ ì„±ëŠ¥ ëŒ€í­ í–¥ìƒ
  - ëª©ì í•¨ìˆ˜ ë‹¨ìˆœí™”: ì•¼ê°„ ê·¼ë¬´ ê· ë“±ì„±ë§Œ ê³ ë ¤

### 3. ì†”ë²„ ì„±ëŠ¥ ìµœì í™”
- **ì‹œê°„ ì œí•œ**: 120ì´ˆ â†’ 30ì´ˆ
- **ì›Œì»¤ ìˆ˜**: 4ê°œ â†’ 1ê°œ (ì˜¤ë²„í—¤ë“œ ìµœì†Œí™”)
- **ë¶ˆí•„ìš”í•œ íŒŒë¼ë¯¸í„° ì œê±°**: í˜¸í™˜ì„± ë¬¸ì œ í•´ê²°
- **ì „ì²˜ë¦¬ ìœ ì§€**: `cp_model_presolve = True` ìœ ì§€

### 4. ë””ë²„ê¹… ë° ëª¨ë‹ˆí„°ë§ ê°œì„ 
- **ì›” ì´ ê·¼ë¬´ì‹œê°„ í†µê³„** ì¶œë ¥ ì¶”ê°€ (ë¼ì¸ 180-183)
- **ì†”ë²„ ìƒíƒœ ë° í•´ê²° ì‹œê°„** ì‹¤ì‹œê°„ ì¶œë ¥
- **ì•¼ê°„ ê·¼ë¬´ ê· ë“±ì„±** ì§€í‘œ ì¶œë ¥

## ğŸ“Š ì„±ëŠ¥ ê°œì„  ê²°ê³¼

### Before (ê¸°ì¡´)
- 20ëª… ì§ì›: 76ì´ˆ+ (íƒ€ì„ì•„ì›ƒ ìœ„í—˜)
- í•´ ì°¾ê¸° ì‹¤íŒ¨ ë¹ˆë²ˆ
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê³¼ë‹¤

### After (ê°œì„  í›„)  
- 10ëª… ì§ì›: 0.34ì´ˆ (ë§¤ìš° ë¹ ë¦„)
- 20ëª… ì§ì›: ì¶”ì • 10-20ì´ˆ ì´ë‚´
- ì•ˆì •ì ì¸ í•´ ìƒì„±
- ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± ì¦ëŒ€

## ğŸ”§ ê¸°ìˆ ì  ê°œì„ ì‚¬í•­

### ë³€ìˆ˜ ë³µì¡ë„ ê°ì†Œ
- ì†Œí”„íŠ¸ ì œì•½ ìœ„ë°˜ ë³€ìˆ˜ ì œê±°: `night_violation_vars` ì‚­ì œ
- ëª©ì í•¨ìˆ˜ ë‹¨ìˆœí™”: ë‹¨ì¼ ì§€í‘œ ìµœì í™”
- ì œì•½ì¡°ê±´ ìˆ˜ ëŒ€í­ ê°ì†Œ

### ì•Œê³ ë¦¬ì¦˜ ìµœì í™”
- í•˜ë“œ ì œì•½ ì‚¬ìš©ìœ¼ë¡œ íƒìƒ‰ ê³µê°„ ëª…í™•í™”
- ë‹¨ì¼ ì›Œì»¤ ì‚¬ìš©ìœ¼ë¡œ ë™ê¸°í™” ì˜¤ë²„í—¤ë“œ ì œê±°
- ì „ì²˜ë¦¬ ìœ ì§€ë¡œ ë¶ˆí•„ìš”í•œ ë³€ìˆ˜ ì‚¬ì „ ì œê±°

## ğŸ¯ í–¥í›„ í™•ì¥ ì „ëµ: JSON ê¸°ë°˜ ì œì•½ì‚¬í•­/ìš”êµ¬ì‚¬í•­ ì²˜ë¦¬

### 1. ì œì•½ì‚¬í•­ JSON ìŠ¤í‚¤ë§ˆ ì„¤ê³„

```json
{
  "schedule_constraints": {
    "global_constraints": {
      "max_weekly_hours": 60,
      "min_monthly_off_days": 2,
      "night_shift_rest_required": true,
      "max_consecutive_work_days": 6
    },
    "shift_constraints": {
      "min_staff_per_shift": {
        "D": 1, "E": 1, "N": 1, "O": 0
      },
      "max_staff_per_shift": {
        "D": 10, "E": 10, "N": 10, "O": 20
      }
    },
    "staff_specific_constraints": [
      {
        "staff_id": 101,
        "max_monthly_hours": 180,
        "preferred_shifts": ["D", "E"],
        "unavailable_dates": ["2025-08-15", "2025-08-16"],
        "max_night_shifts_per_month": 8
      }
    ],
    "business_rules": {
      "senior_staff_night_priority": true,
      "weekend_coverage_required": true,
      "holiday_double_coverage": ["2025-08-15"]
    }
  },
  "optimization_preferences": {
    "priority_order": [
      "staff_satisfaction",
      "workload_balance", 
      "business_continuity"
    ],
    "fairness_weight": 0.7,
    "efficiency_weight": 0.3
  }
}
```

### 2. êµ¬í˜„ ì „ëµ

#### A. ì œì•½ì‚¬í•­ íŒŒì‹± ëª¨ë“ˆ
```python
def parse_constraints(constraints_json):
    """JSON ì œì•½ì‚¬í•­ì„ OR-Tools ì œì•½ìœ¼ë¡œ ë³€í™˜"""
    global_constraints = constraints_json.get("global_constraints", {})
    staff_constraints = constraints_json.get("staff_specific_constraints", [])
    business_rules = constraints_json.get("business_rules", {})
    
    return {
        "global": process_global_constraints(global_constraints),
        "staff": process_staff_constraints(staff_constraints), 
        "business": process_business_rules(business_rules)
    }
```

#### B. ë™ì  ì œì•½ ì ìš©
```python
def apply_dynamic_constraints(model, schedule, constraints):
    """íŒŒì‹±ëœ ì œì•½ì‚¬í•­ì„ ëª¨ë¸ì— ë™ì  ì ìš©"""
    for constraint_type, rules in constraints.items():
        if constraint_type == "global":
            apply_global_constraints(model, schedule, rules)
        elif constraint_type == "staff":
            apply_staff_constraints(model, schedule, rules)
        elif constraint_type == "business":
            apply_business_constraints(model, schedule, rules)
```

#### C. ì œì•½ì‚¬í•­ ìš°ì„ ìˆœìœ„ ì²˜ë¦¬
```python
def prioritize_constraints(constraints):
    """ì œì•½ì‚¬í•­ì„ í•˜ë“œ/ì†Œí”„íŠ¸ë¡œ ë¶„ë¥˜í•˜ê³  ìš°ì„ ìˆœìœ„ ì ìš©"""
    hard_constraints = []  # ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•˜ëŠ” ì œì•½
    soft_constraints = []  # ê°€ëŠ¥í•˜ë©´ ì§€í‚¤ëŠ” ì œì•½ (ê°€ì¤‘ì¹˜ ì ìš©)
    
    # ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ë¶„ë¥˜ ë¡œì§
    return hard_constraints, soft_constraints
```

### 3. í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜

#### ì œì•½ì‚¬í•­ í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ
- **ëª¨ë“ˆí™”**: ê° ì œì•½ì‚¬í•­ì„ ë…ë¦½ì ì¸ ëª¨ë“ˆë¡œ êµ¬í˜„
- **í•«ìŠ¤ì™‘**: ìš´ì˜ ì¤‘ ì œì•½ì‚¬í•­ ë³€ê²½ ê°€ëŠ¥
- **ë²„ì „ ê´€ë¦¬**: ì œì•½ì‚¬í•­ ìŠ¤í‚¤ë§ˆ ë²„ì „ë³„ í˜¸í™˜ì„± ìœ ì§€

#### ì„±ëŠ¥ ìµœì í™” ì „ëµ
- **ì œì•½ì‚¬í•­ ìºì‹±**: ë™ì¼í•œ ì œì•½ ì¡°í•© ì¬ì‚¬ìš©
- **ì ì§„ì  ìµœì í™”**: í•˜ë“œ ì œì•½ ë¨¼ì €, ì†Œí”„íŠ¸ ì œì•½ ìˆœì°¨ ì ìš©
- **ì¡°ê¸° ì¢…ë£Œ**: ë§Œì¡± ê°€ëŠ¥í•œ í•´ ë°œê²¬ì‹œ ì¦‰ì‹œ ë°˜í™˜

### 4. API í™•ì¥ì•ˆ

```python
# ìƒˆë¡œìš´ API ì—”ë“œí¬ì¸íŠ¸
POST /schedule/create
{
  "staff_data": {...},
  "shift_type": 3,
  "constraints": {...},  # ìƒˆë¡œìš´ ì œì•½ì‚¬í•­ JSON
  "optimization_goals": {...}
}

# ì œì•½ì‚¬í•­ ê²€ì¦ ì—”ë“œí¬ì¸íŠ¸  
POST /schedule/validate-constraints
{
  "constraints": {...}
}

# ì œì•½ì‚¬í•­ í…œí”Œë¦¿ ì œê³µ
GET /schedule/constraint-templates
```

### 5. êµ¬í˜„ ìš°ì„ ìˆœìœ„

1. **Phase 1**: ê¸°ë³¸ JSON ìŠ¤í‚¤ë§ˆ ì •ì˜ ë° íŒŒì‹± ëª¨ë“ˆ
2. **Phase 2**: í•µì‹¬ ì œì•½ì‚¬í•­ ë™ì  ì ìš© (ì›” ê·¼ë¬´ì‹œê°„, íœ´ë¬´ì¼ ë“±)
3. **Phase 3**: ì§ì›ë³„ ê°œë³„ ì œì•½ì‚¬í•­ ì²˜ë¦¬
4. **Phase 4**: ë¹„ì¦ˆë‹ˆìŠ¤ ë£° ë° ìµœì í™” ëª©í‘œ ì ìš©
5. **Phase 5**: ê³ ê¸‰ ê¸°ëŠ¥ (ì œì•½ì‚¬í•­ ê²€ì¦, í…œí”Œë¦¿, ì„±ëŠ¥ ìµœì í™”)

## ğŸ“ ê°œë°œì ë…¸íŠ¸

### ì£¼ì˜ì‚¬í•­
- ì›” ì´ ê·¼ë¬´ì‹œê°„ì— 10% ì—¬ìœ ë¶„ì´ ì ìš©ë˜ë¯€ë¡œ ì‹¤ì œ ê²°ê³¼ í™•ì¸ í•„ìš”
- ì œì•½ì¡°ê±´ì´ ë„ˆë¬´ ì—„ê²©í•˜ë©´ í•´ê°€ ì—†ì„ ìˆ˜ ìˆìŒ
- ëŒ€ìš©ëŸ‰ ë°ì´í„°(50ëª… ì´ìƒ)ì—ì„œëŠ” ì¶”ê°€ ìµœì í™” í•„ìš”í•  ìˆ˜ ìˆìŒ

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
- 10ëª… ì§ì›: 0.34ì´ˆ (âœ… ê²€ì¦ì™„ë£Œ)
- 20ëª… ì§ì›: ì¶”ê°€ í…ŒìŠ¤íŠ¸ í•„ìš”
- ì œì•½ì¡°ê±´ ì¶©ëŒ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ í•„ìš”

### ëª¨ë‹ˆí„°ë§ ì§€í‘œ
- ì†”ë²„ í•´ê²° ì‹œê°„
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰  
- ì œì•½ì¡°ê±´ ìœ„ë°˜ íšŸìˆ˜
- ì›” ì´ ê·¼ë¬´ì‹œê°„ ì¤€ìˆ˜ìœ¨